
@{
    ViewData["Title"] = "Address";
}

<h1>Address</h1>
<select id="select1">
    @*<option value=""></option>*@
</select>
<select id="select2">
    @*<option value=""></option>*@
</select>
<select id="select3">
    @*<option value=""></option>*@
</select>

@section Scripts{
    <script>
        const selCity = document.querySelector("#select1")
        const selSite = document.querySelector("#select2")
        const selRoad = document.querySelector("#select3")

        async function LoadCities() {
            let response = await fetch("@Url.Content("~/api/city")")
            let datas = await response.json()
            datas.forEach(city => {
                const opt = new Option(city, city)
                selCity.options.add(opt)
            })
        }
        LoadCities()

        selCity.addEventListener("change", async () => {
            
            //console.log(selCity.options[selCity.selectedIndex].value)
            const url = "@Url.Content("~/api/site")"
            const params = `?city=${selCity.options[selCity.selectedIndex].value}`
            let response = await fetch(url + params)
            let datas = await response.json()
            //console.log(datas)
            selSite.options.length = 0
            datas.forEach(site => {
                const opt = new Option(site, site)
                selSite.options.add(opt)
            })
        })
        selSite.addEventListener("change", async () => {
            const url = "@Url.Content("~/api/road")"
            const params = `?site=${selSite.options[selSite.selectedIndex].value}`
            let response = await fetch(url + params)
            let datas = await response.json()
            selRoad.options.length = 0
            datas.forEach(road => {
                const opt = new Option(road, road)
                selRoad.options.add(opt)
            })
        })

    </script>
}